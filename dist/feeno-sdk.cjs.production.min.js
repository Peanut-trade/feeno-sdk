"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("axios")),r=require("@ethereumjs/common"),n=e(r),a=require("ethers"),i=require("@uniswap/v3-periphery/artifacts/contracts/NonfungiblePositionManager.sol/NonfungiblePositionManager.json"),o=require("@ethereumjs/tx");function s(e,t,r,n,a,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){s(i,n,a,o,u,"next",e)}function u(e){s(i,n,a,o,u,"throw",e)}o(void 0)}))}}var c,p,h=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var a=Object.create((t&&t.prototype instanceof h?t:h).prototype),i=new S(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return{value:void 0,done:!0}}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,i),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function h(){}function l(){}function f(){}var y={};s(y,a,(function(){return this}));var d=Object.getPrototypeOf,m=d&&d(d(k([])));m&&m!==t&&r.call(m,a)&&(y=m);var v=f.prototype=h.prototype=Object.create(y);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){var n;this._invoke=function(a,i){function o(){return new t((function(n,o){!function n(a,i,o,s){var u=c(e[a],e,i);if("throw"!==u.type){var p=u.arg,h=p.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){p.value=e,o(p)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}(a,i,n,o)}))}return n=n?n.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function k(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return l.prototype=f,s(v,"constructor",f),s(f,"constructor",l),l.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},g(x.prototype),s(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var o=new x(u(t,r,n,a),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(v),s(v,o,"Generator"),s(v,a,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=k,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;T(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(p={exports:{}}),p.exports),l="http://localhost:6200/v1",f=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}],y=function(){function e(e,t){this.estimationResponse=e,this.provider=t,this.signer=t.getSigner(),this.chainId=5,this.common=new n({chain:this.chainId,hardfork:r.Hardfork.London}),this.maxFeePerGas=a.ethers.utils.parseUnits(this.estimationResponse.marketGasPriceGwei.baseFee.toString(),"gwei")._hex,this.maxPriorityFeePerGas=a.ethers.utils.hexlify(a.ethers.BigNumber.from(0))}var s=e.prototype;return s._getSwapType=function(e){return"optimalSwap"===e.exType?this.estimationResponse.executionSwap.dexSwap.miningSpeed[e.speed].ethGasFee>this.estimationResponse.executionSwap.cexSwap.miningSpeed[e.speed].ethGasFee?"dexSwap":"cexSwap":e.exType},s._approveTokensUse=function(){var e=u(h.mark((function e(t){var r,n,s=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.estimationResponse.approveRequired,e.next=3,this.signer.getAddress();case 3:return n=e.sent,e.abrupt("return",Promise.all(r.map(function(){var e=u(h.mark((function e(r,u){var c,p,l,y,d,m,v,g,x,w;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=s.estimationResponse.executionSwap[t].simulations.approve[u].gasUsage,r.tokenId?(l=new a.ethers.Contract(r.tokenAddress.toString(),i.abi,s.provider),y=r.tokenId,p=a.ethers.BigNumber.from(55e3)):(l=new a.ethers.Contract(r.tokenAddress.toString(),f,s.provider),y=r.amount,p=a.ethers.BigNumber.from(c)),e.next=4,l.populateTransaction.approve(r.spender,y);case 4:return d=e.sent,e.next=7,s.signer.getTransactionCount();case 7:if(e.t0=e.sent,e.t1=u,m=e.t0+e.t1,v=o.FeeMarketEIP1559Transaction.fromTxData({type:"0x02",chainId:a.ethers.utils.hexlify(s.chainId),nonce:a.ethers.utils.hexlify(a.ethers.BigNumber.from(m),{hexPad:"left"}),maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas,gasLimit:a.ethers.utils.hexlify(p,{hexPad:"left"}),to:d.to,value:a.ethers.utils.hexlify(a.ethers.BigNumber.from(0)),data:d.data},{common:s.common}),g=v.getMessageToSign(),!s.provider.provider.request){e.next=18;break}return e.next=15,s.provider.provider.request({method:"eth_sign",params:[n,a.ethers.utils.hexlify(g)]});case 15:e.t2=e.sent,e.next=19;break;case 18:e.t2="";case 19:return x=a.ethers.utils.splitSignature(e.t2),w=v._processSignature(x.v,Buffer.from(a.ethers.utils.arrayify(x.r)),Buffer.from(a.ethers.utils.arrayify(x.s))),e.abrupt("return",a.ethers.utils.hexlify(w.serialize()));case 23:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s._approveETHTransfer=function(){var e=u(h.mark((function e(t,r,n){var i,s,u,c,p,l,f,y;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signer.getAddress();case 2:return s=e.sent,u="0xFee1708400f01f2Bb8848Ef397C1a2F4C25c910B",c=(this.estimationResponse.executionSwap[t].miningSpeed[r].ethGasFee*Math.pow(10,18)).toFixed(0),i=this.estimationResponse.ETHQuantity?this.estimationResponse.erc20TokenToPayFee?a.ethers.BigNumber.from(this.estimationResponse.ETHQuantity).add(c).toString():this.estimationResponse.ETHQuantity:c,e.t0=a.ethers.utils.hexlify(this.chainId),e.t1=a.ethers.utils,e.t2=a.ethers.BigNumber,e.next=11,this.signer.getTransactionCount();case 11:if(e.t3=e.sent,e.t4=n,e.t5=e.t3+e.t4,e.t6=e.t2.from.call(e.t2,e.t5),e.t7={hexPad:"left"},e.t8=e.t1.hexlify.call(e.t1,e.t6,e.t7),e.t9=this.maxFeePerGas,e.t10=this.maxPriorityFeePerGas,e.t11=a.ethers.utils.hexlify(a.ethers.BigNumber.from(21100),{hexPad:"left"}),e.t12=s,e.t13=u,e.t14=a.ethers.utils.hexlify(a.ethers.BigNumber.from(i)),p=o.FeeMarketEIP1559Transaction.fromTxData({type:"0x02",chainId:e.t0,nonce:e.t8,maxFeePerGas:e.t9,maxPriorityFeePerGas:e.t10,gasLimit:e.t11,from:e.t12,to:e.t13,value:e.t14},{common:this.common}),l=p.getMessageToSign(),!this.provider.provider.request){e.next=32;break}return e.next=29,this.provider.provider.request({method:"eth_sign",params:[s,a.ethers.utils.hexlify(l)]});case 29:e.t15=e.sent,e.next=33;break;case 32:e.t15="";case 33:return f=a.ethers.utils.splitSignature(e.t15),y=p._processSignature(f.v,Buffer.from(a.ethers.utils.arrayify(f.r)),Buffer.from(a.ethers.utils.arrayify(f.s))),e.abrupt("return",a.ethers.utils.hexlify(y.serialize()));case 37:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}(),s._approveTransaction=function(){var e=u(h.mark((function e(t,r){var n,i,o;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signer.getAddress();case 2:if(n=e.sent,i=a.ethers.utils.arrayify(this.estimationResponse.executionSwap[t].miningSpeed[r].data.messageForSing),o=a.ethers.utils.keccak256(a.ethers.utils.concat([a.ethers.utils.toUtf8Bytes("Ethereum Signed Message:\n"),a.ethers.utils.toUtf8Bytes(String(i.length)),i])),!this.provider.provider.request){e.next=12;break}return e.next=9,this.provider.provider.request({method:"eth_sign",params:[n,o]});case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0="";case 13:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s.send=function(){var e=u(h.mark((function e(r){var n,a,i,o;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._getSwapType(r),e.next=3,this._approveTokensUse(n);case 3:if(a=e.sent,!this.estimationResponse.ETHQuantity&&this.estimationResponse.erc20TokenToPayFee){e.next=10;break}return e.t0=a,e.next=8,this._approveETHTransfer(n,r.speed,a.length);case 8:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 10:return e.next=12,this._approveTransaction(n,r.speed);case 12:return i={estimationId:this.estimationResponse.id,approvalTxRawData:a,userSign:e.sent,processingMode:n,miningSpeed:r.speed,blocksCountToResubmit:20},e.next=17,t.post("http://localhost:6200/v1/submit",i);case 17:return this.bundleId=(o=e.sent).data.bundleId,e.abrupt("return",o.data);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.cancel=function(){var e=u(h.mark((function e(){var r;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l+"/bundle/"+this.bundleId+"/cancel",e.next=3,t.delete(r);case 3:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.getStatus=function(){var e=u(h.mark((function e(){var r;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l+"/bundle/"+this.bundleId,e.next=3,t.get(r);case 3:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}(),d=function(){function e(){}return e.createFeenoRequest=function(){var e=u(h.mark((function e(r,n){return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,t.post("http://localhost:6200/v1/estimate",r);case 3:return e.abrupt("return",new y(e.sent.data,n));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e}();(exports.TransactionStatus||(exports.TransactionStatus={})).InprogressType="inProgress",(c=exports.TransactionType||(exports.TransactionType={})).TransferType="transfer",c.SwapInputType="exactInput",c.SwapOutputType="exactOutput",c.SwapInputSingleType="exactInputSingle",c.SwapOutputSingleType="exactOutputSingle",c.ClaimFeeType="claimFee",c.CreatePositionType="createPosition",c.IncreaseLiquidityType="increaseLiquidity",c.DecreaseLiquidityType="decreaseLiquidity",c.CollectType="collect",c.SwapExactTokensForTokensType="swapExactTokensForTokens",c.SwapExactTokensForETHType="swapExactTokensForETH",c.SwapExactETHForTokensType="swapExactETHForTokens",exports.FeeNo=d,exports.FeeNoRequest=y;
//# sourceMappingURL=feeno-sdk.cjs.production.min.js.map
